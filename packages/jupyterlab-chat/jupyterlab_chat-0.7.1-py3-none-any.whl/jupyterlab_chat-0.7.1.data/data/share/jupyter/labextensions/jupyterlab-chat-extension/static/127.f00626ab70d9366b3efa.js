"use strict";(self.webpackChunkjupyterlab_chat_extension=self.webpackChunkjupyterlab_chat_extension||[]).push([[127],{5127:(e,t,n)=>{n.r(t),n.d(t,{ActiveCellManager:()=>s,AutocompletionRegistry:()=>Ne,Avatar:()=>Ae,CancelButton:()=>W,Chat:()=>Ie,ChatBody:()=>Me,ChatInput:()=>K,ChatMessage:()=>we,ChatMessageHeader:()=>xe,ChatMessages:()=>ye,ChatModel:()=>je,ChatWidget:()=>Oe,CodeToolbar:()=>ie,ContrastingTooltip:()=>N,CopyButton:()=>ee,IAutocompletionRegistry:()=>Re,JlThemeProvider:()=>v,MarkdownRenderer:()=>de,MessageToolbar:()=>re,Navigation:()=>ke,ScrollContainer:()=>ue,SelectionWatcher:()=>De,SendButton:()=>Z,TooltippedButton:()=>V,TooltippedIconButton:()=>Q,Writers:()=>Se,buildChatSidebar:()=>$e,buildErrorWidget:()=>ze,chatIcon:()=>B,includeSelectionIcon:()=>O,readIcon:()=>z,replaceCellIcon:()=>$});var i=n(3161),a=n(6228),l=n(4602);class s{constructor(e){var t,n;this._onMainAreaChanged=()=>{var e,t;const n=null!==(t=null===(e=this._notebookTracker.currentWidget)||void 0===e?void 0:e.isVisible)&&void 0!==t&&t;n!==this._notebookVisible&&(this._notebookVisible=n,this._available=!!this._activeCell&&this._notebookVisible,this._availabilityChanged.emit(this._available))},this._onActiveCellChanged=(e,t)=>{var n;this._activeCell!==t&&(null===(n=this._activeCell)||void 0===n||n.model.stateChanged.disconnect(this._cellStateChange),this._activeCell=t,null==t||t.ready.then((()=>{var e,t;null===(e=this._activeCell)||void 0===e||e.model.stateChanged.connect(this._cellStateChange),this._available=!!this._activeCell&&this._notebookVisible,this._availabilityChanged.emit(this._available),null===(t=this._activeCell)||void 0===t||t.disposed.connect((()=>{this._activeCell=null}))})))},this._cellStateChange=(e,t)=>{var n;if("executionCount"===t.name){const e=null===(n=this._activeCell)||void 0===n?void 0:n.model.sharedModel,t=this._activeCellError;let i=null;e&&"outputs"in e&&(i=e.outputs.find((e=>"error"===e.output_type))||null),t!==i&&(this._activeCellError=i,this._activeCellErrorChanged.emit(this._activeCellError))}},this._notebookVisible=!1,this._activeCell=null,this._available=!1,this._activeCellError=null,this._availabilityChanged=new l.Signal(this),this._activeCellErrorChanged=new l.Signal(this),this._notebookTracker=e.tracker,this._notebookTracker.activeCellChanged.connect(this._onActiveCellChanged),null===(t=e.shell.currentChanged)||void 0===t||t.connect(this._onMainAreaChanged),e.shell instanceof i.LabShell&&(null===(n=e.shell.layoutModified)||void 0===n||n.connect(this._onMainAreaChanged)),this._onMainAreaChanged()}get available(){return this._available}get activeCellError(){return this._activeCellError}get availabilityChanged(){return this._availabilityChanged}get activeCellErrorChanged(){return this._activeCellErrorChanged}getContent(e=!1){var t;const n=null===(t=this._notebookTracker.activeCell)||void 0===t?void 0:t.model.sharedModel;if(!n)return null;if(!e)return{type:n.cell_type,source:n.getSource()};const i=this._activeCellError;return i?{type:"code",source:n.getSource(),error:{name:i.ename,value:i.evalue,traceback:i.traceback}}:null}insertAbove(e){const t=this._notebookTracker.currentWidget;t&&t.isVisible&&(a.NotebookActions.insertAbove(t.content),this.replace(e))}insertBelow(e){const t=this._notebookTracker.currentWidget;t&&t.isVisible&&(a.NotebookActions.insertBelow(t.content),this.replace(e))}async replace(e){var t;const n=this._notebookTracker.currentWidget;if(!n||!n.isVisible)return;const i=this._notebookTracker.activeCell;i&&(await i.ready,null===(t=i.editor)||void 0===t||t.model.sharedModel.setSource(e))}}var o=n(7446),r=n(4087),c=n(6309),d=n(4079),u=n(5726),h=n.n(u),m=n(2276),g=n(3325);function p(e){return getComputedStyle(document.body).getPropertyValue(e).trim()}function v(e){const[t,n]=(0,u.useState)((0,m.A)());return(0,u.useEffect)((()=>{var t;async function i(){n(await async function(){await async function(){for(;!document.body.hasAttribute("data-jp-theme-light");)await new Promise((e=>setTimeout(e,100)))}();const e=document.body.getAttribute("data-jp-theme-light");return(0,m.A)({spacing:4,components:{MuiButton:{defaultProps:{size:"small"}},MuiFilledInput:{defaultProps:{margin:"dense"}},MuiFormControl:{defaultProps:{margin:"dense",size:"small"}},MuiFormHelperText:{defaultProps:{margin:"dense"}},MuiIconButton:{defaultProps:{size:"small"}},MuiInputBase:{defaultProps:{margin:"dense",size:"small"}},MuiInputLabel:{defaultProps:{margin:"dense"}},MuiListItem:{defaultProps:{dense:!0}},MuiOutlinedInput:{defaultProps:{margin:"dense"}},MuiFab:{defaultProps:{size:"small"}},MuiTable:{defaultProps:{size:"small"}},MuiTextField:{defaultProps:{margin:"dense",size:"small"}},MuiToolbar:{defaultProps:{variant:"dense"}}},palette:{background:{paper:p("--jp-layout-color1"),default:p("--jp-layout-color1")},mode:"true"===e?"light":"dark",primary:{main:p("--jp-brand-color1"),light:p("--jp-brand-color2"),dark:p("--jp-brand-color0")},error:{main:p("--jp-error-color1"),light:p("--jp-error-color2"),dark:p("--jp-error-color0")},warning:{main:p("--jp-warn-color1"),light:p("--jp-warn-color2"),dark:p("--jp-warn-color0")},success:{main:p("--jp-success-color1"),light:p("--jp-success-color2"),dark:p("--jp-success-color0")},text:{primary:p("--jp-ui-font-color1"),secondary:p("--jp-ui-font-color2"),disabled:p("--jp-ui-font-color3")}},shape:{borderRadius:2},typography:{fontFamily:p("--jp-ui-font-family"),fontSize:12,htmlFontSize:16,button:{textTransform:"capitalize"}}})}())}i(),null===(t=e.themeManager)||void 0===t||t.themeChanged.connect(i)}),[]),h().createElement(g.A,{theme:t},e.children)}var f=n(180),C=n(6960),b=n(7262),_=n(5632),E=n(3099),y=n(9578),x=n(4838),w=n(8507),S=n(585),k=n(2753),A=n(3360),M=n(4057),I=n(9193),j=n(7086),R=n(6644);const N=(0,I.Ay)((({className:e,...t})=>h().createElement(j.A,{...t,arrow:!0,classes:{popper:e}})))((({theme:e})=>({[`& .${R.A.tooltip}`]:{backgroundColor:e.palette.common.black,color:e.palette.common.white,boxShadow:e.shadows[1],fontSize:11},[`& .${R.A.arrow}`]:{color:e.palette.common.black}})));function V(e){var t;return h().createElement(N,{title:e.tooltip,placement:null!==(t=e.placement)&&void 0!==t?t:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,-8]}}]}}},h().createElement("span",{style:{cursor:"default"}},h().createElement(M.A,{...e.buttonProps,onClick:e.onClick,disabled:e.disabled,sx:{lineHeight:0,...e.disabled&&{opacity:.5},...e.sx},"aria-label":e["aria-label"]},e.children)))}const T="jp-chat-cancel-button";function W(e){const t="Cancel edition";return h().createElement(V,{onClick:e.onCancel,tooltip:t,buttonProps:{size:"small",variant:"contained",title:t,className:T},sx:{minWidth:"unset",padding:"4px",borderRadius:"2px 0px 0px 2px",marginRight:"1px"}},h().createElement(A.A,null))}var P=n(6270),L=n(6748),D=n(9770),H=n(1147);const B=new C.LabIcon({name:"jupyter-chat::chat",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16">\n  <g class="jp-icon3" fill="#616161">\n    <path d="M0 0h24v24H0V0z" fill="none"/>\n    <path d="M15 4v7H5.17L4 12.17V4h11m1-2H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1zm5 4h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1z"/>\n  </g>\n</svg>\n'}),z=new C.LabIcon({name:"jupyter-chat::read",svgstr:'<svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">\n  <g>\n    <path\n       style="display:inline;fill:none;fill-opacity:1;stroke:#545454;stroke-width:1.54693;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:1.5;stroke-dasharray:none;stroke-opacity:1;paint-order:normal"\n       d="M 2.2734634,9 V 20.226537 H 21.726536 V 9" />\n    <path\n       style="display:inline;fill:none;stroke:#545454;stroke-width:1.54528;stroke-linecap:square;stroke-miterlimit:10"\n       transform="matrix(0.81805878,0.57513462,-0.81805878,0.57513462,0,0)"\n       d="M 9.5141659,-5.1535239 H 20.802967 V 6.1352773 H 9.5141659 Z" />\n  </g>\n</svg>\n'}),$=new C.LabIcon({name:"jupyter-ai::replace-cell",svgstr:'<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path fill-rule="evenodd" clip-rule="evenodd"\n        d="M12 4.71429V7H1.71429V4.71429H12ZM12.5714 3C13.2026 3 13.7143 3.51168 13.7143 4.14286V7.57143C13.7143 8.20263 13.2026 8.71429 12.5714 8.71429H1.14286C0.51168 8.71429 0 8.20263 0 7.57143V4.14286C0 3.51168 0.511669 3 1.14286 3H12.5714Z"\n        fill="#565656" />\n    <path fill-rule="evenodd" clip-rule="evenodd"\n        d="M14 8.71429V11H3.71429V8.71429H14ZM14.5714 7C15.2026 7 15.7143 7.51168 15.7143 8.14286V11.5714C15.7143 12.2026 15.2026 12.7143 14.5714 12.7143H3.14286C2.51168 12.7143 2 12.2026 2 11.5714V8.14286C2 7.51168 2.51167 7 3.14286 7H14.5714Z"\n        fill="#565656" />\n</svg>\n'}),O=new C.LabIcon({name:"jupyter-chat::include",svgstr:'<svg width="18" height="9" viewBox="0 0 18 9" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path fill-rule="evenodd" clip-rule="evenodd"\n        d="M-0.0018417 1.33824L0.837379 0.499023L1.35717 1.01871C1.35741 1.01862 1.35764 1.01853 1.35787 1.01845L3.411 3.07158H3.41049L4.83909 4.49987L3.41011 5.92872H3.41075L1.35769 7.98178C1.35749 7.98171 1.35729 7.98164 1.35709 7.98156L0.837023 8.50158L-0.00219727 7.66236L3.1547 4.49987L-0.0018417 1.33824ZM2.6821 8.07158H16.143C16.932 8.07158 17.5716 7.43201 17.5716 6.64301V2.35729C17.5716 1.56832 16.932 0.928721 16.143 0.928721H2.68236L4.82522 3.07158H15.4287V5.92872H4.82496L2.6821 8.07158ZM1.74238 4.50002L0.428719 5.81655V3.18349L1.74238 4.50002Z"\n        fill="#757575" />\n</svg>\n'}),F="jp-chat-send-button",U="jp-chat-send-include-opener",J="jp-chat-send-include";function Z(e){var t,n;const{activeCellManager:i,selectionWatcher:a}=e.model,l=null!==(t=e.hideIncludeSelection)&&void 0!==t&&t,s=null!==(n=e.hasButtonOnLeft)&&void 0!==n&&n,[o,r]=(0,u.useState)(null),[c,d]=(0,u.useState)(!1),m=(0,u.useCallback)((e=>{r(e),d(!0)}),[]),g=(0,u.useCallback)((()=>{d(!1)}),[]),p=!e.inputExists,[v,f]=(0,u.useState)(""),[C,b]=(0,u.useState)(!0);(0,u.useEffect)((()=>{const e=()=>{b(!((null==a?void 0:a.selection)||(null==i?void 0:i.available)));const e=(null==a?void 0:a.selection)?`${a.selection.numLines} line(s) selected`:(null==i?void 0:i.available)?"Code from 1 active cell":"No selection or active cell";f(e)};return l||(null==a||a.selectionChanged.connect(e),null==i||i.availabilityChanged.connect(e),e()),()=>{null==a||a.selectionChanged.disconnect(e),null==i||i.availabilityChanged.disconnect(e)}}),[i,a,l]);const y=e.sendWithShiftEnter?"Send message (SHIFT+ENTER)":"Send message (ENTER)",x=y;return h().createElement(_.A,{sx:{display:"flex",flexWrap:"nowrap"}},h().createElement(V,{onClick:()=>e.onSend(),disabled:p,tooltip:x,buttonProps:{size:"small",title:y,variant:"contained",className:F},sx:{minWidth:"unset",borderTopLeftRadius:s?"0px":"2px",borderTopRightRadius:l?"2px":"0px",borderBottomRightRadius:l?"2px":"0px",borderBottomLeftRadius:s?"0px":"2px"}},h().createElement(L.A,null)),!l&&h().createElement(h().Fragment,null,h().createElement(V,{onClick:e=>{m(e.currentTarget)},disabled:p,tooltip:"",buttonProps:{variant:"contained",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(m(e.currentTarget),e.stopPropagation())},className:U},sx:{minWidth:"unset",padding:"4px 0px",borderRadius:"0px 2px 2px 0px",marginLeft:"1px"}},h().createElement(P.A,null)),h().createElement(D.A,{open:c,onClose:g,anchorEl:o,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},sx:{"& .MuiMenuItem-root":{display:"flex",alignItems:"center",gap:"8px"},"& svg":{lineHeight:0}}},h().createElement(H.A,{onClick:t=>{(null==a?void 0:a.selection)?(e.onSend({type:"text",source:a.selection.text}),g()):(null==i?void 0:i.available)&&(e.onSend({type:"cell",source:i.getContent(!1).source}),g()),t.stopPropagation()},disabled:C,className:J},h().createElement(O.react,null),h().createElement(_.A,null,h().createElement(E.A,{display:"block"},"Send message with selection"),h().createElement(E.A,{display:"block",sx:{opacity:.618}},v))))))}const G="jp-chat-input-container";function K(e){var t,n,i,a;const{autocompletionName:l,autocompletionRegistry:s,model:o}=e,r=(0,u.useRef)(),[c,d]=(0,u.useState)(e.value||""),[m,g]=(0,u.useState)(null!==(t=o.config.sendWithShiftEnter)&&void 0!==t&&t),[p,v]=(0,u.useState)(null!==(n=o.config.sendTypingNotification)&&void 0!==n&&n);let f=null!==(i=e.hideIncludeSelection)&&void 0!==i&&i;null===o.activeCellManager&&null===o.selectionWatcher&&(f=!0);const C=(0,u.useRef)();(0,u.useEffect)((()=>{var e;const t=(e,t)=>{var n,i;g(null!==(n=t.sendWithShiftEnter)&&void 0!==n&&n),v(null!==(i=t.sendTypingNotification)&&void 0!==i&&i)};o.configChanged.connect(t);const n=()=>{C.current&&C.current.focus()};return null===(e=o.focusInputSignal)||void 0===e||e.connect(n),()=>{var e,i;null===(e=o.configChanged)||void 0===e||e.disconnect(t),null===(i=o.focusInputSignal)||void 0===i||i.disconnect(n)}}),[o]);const[b,E]=(0,u.useState)([]),[y,A]=(0,u.useState)(!1),[M,I]=(0,u.useState)(!1),j=!!c.trim();function R(e){if("Enter"===e.key&&!y)return j?void((m&&e.shiftKey||!m&&!e.shiftKey)&&(N(),e.stopPropagation(),e.preventDefault())):(e.stopPropagation(),void e.preventDefault())}function N(t){let n=c;t&&(n+=`\n\n\`\`\`\n${t.source}\n\`\`\`\n`),e.onSend(n),d("")}function V(){d(e.value||""),e.onCancel()}(0,u.useEffect)((()=>{void 0!==s&&(r.current=l?s.get(l):s.getDefaultCompletion(),void 0!==r.current&&(Array.isArray(r.current.commands)?E(r.current.commands):"function"==typeof r.current.commands&&r.current.commands().then((e=>{E(e)}))))}),[]),(0,u.useEffect)((()=>{var e,t;(null===(e=r.current)||void 0===e?void 0:e.opener)&&(c!==(null===(t=r.current)||void 0===t?void 0:t.opener)?""!==c||I(!1):I(!0))}),[c]);const T=m?h().createElement("span",null,"Press ",h().createElement("b",null,"Shift"),"+",h().createElement("b",null,"Enter")," to send message"):h().createElement("span",null,"Press ",h().createElement("b",null,"Shift"),"+",h().createElement("b",null,"Enter")," to add a new line");return h().createElement(_.A,{sx:e.sx,className:(0,x.A)(G)},h().createElement(w.A,{options:b,value:e.value,open:M,autoHighlight:!0,freeSolo:!0,componentsProps:{popper:{placement:"top"},paper:{sx:{border:"1px solid lightgray"}}},ListboxProps:{sx:{"& .MuiAutocomplete-option":{padding:2}}},renderInput:t=>h().createElement(S.A,{...t,fullWidth:!0,variant:"outlined",multiline:!0,onKeyDown:R,placeholder:"Start chatting",inputRef:C,InputProps:{...t.InputProps,endAdornment:h().createElement(k.A,{position:"end"},e.onCancel&&h().createElement(W,{onCancel:V}),h().createElement(Z,{model:o,sendWithShiftEnter:m,inputExists:j,onSend:N,hideIncludeSelection:f,hasButtonOnLeft:!!e.onCancel}))},FormHelperTextProps:{sx:{marginLeft:"auto",marginRight:0}},helperText:c.length>2?T:" "}),...null===(a=r.current)||void 0===a?void 0:a.props,inputValue:c,onInputChange:(e,t)=>{d(t),p&&o.inputChanged&&o.inputChanged(t)},onHighlightChange:(e,t)=>{A(!!t)},onClose:()=>{A(!1),I(!1)},disableClearable:!0}))}var Y,q=n(7628);function Q(e){var t;return h().createElement(N,{title:e.tooltip,placement:null!==(t=e.placement)&&void 0!==t?t:"top",slotProps:{popper:{modifiers:[{name:"offset",options:{offset:[0,-8]}}]}}},h().createElement("span",{className:e.className},h().createElement(c.A,{...e.iconButtonProps,onClick:e.onClick,disabled:e.disabled,sx:{marginLeft:"8px",lineHeight:0,...e.disabled&&{opacity:.5}},"aria-label":e["aria-label"]},e.children)))}!function(e){e[e.None=0]="None",e[e.Copying=1]="Copying",e[e.Copied=2]="Copied"}(Y||(Y={}));const X={[Y.None]:"Copy to clipboard",[Y.Copying]:"Copying…",[Y.Copied]:"Copied!"};function ee(e){const[t,n]=(0,u.useState)(Y.None),i=(0,u.useRef)(null),a=(0,u.useCallback)((async()=>{if(t!==Y.Copying){try{await navigator.clipboard.writeText(e.value)}catch(e){return console.error("Failed to copy text: ",e),void n(Y.None)}n(Y.Copied),i.current&&clearTimeout(i.current),i.current=window.setTimeout((()=>n(Y.None)),1e3)}}),[t,e.value]);return h().createElement(Q,{className:e.className,tooltip:X[t],placement:"top",onClick:a,"aria-label":"Copy to clipboard"},h().createElement(C.copyIcon.react,{height:"16px",width:"16px"}))}const te="jp-chat-code-toolbar",ne="jp-chat-code-toolbar-item";function ie(e){var t;const{content:n,model:i}=e,[a,l]=(0,u.useState)(null===(t=i.config.enableCodeToolbar)||void 0===t||t),s=i.activeCellManager,o=i.selectionWatcher,[r,c]=(0,u.useState)({content:n,activeCellManager:s,selectionWatcher:o,activeCellAvailable:!!(null==s?void 0:s.available),selectionExists:!!(null==o?void 0:o.selection)});return(0,u.useEffect)((()=>{const e=()=>{var e;l(null===(e=i.config.enableCodeToolbar)||void 0===e||e)},t=()=>{c({content:n,activeCellManager:s,selectionWatcher:o,activeCellAvailable:!!(null==s?void 0:s.available),selectionExists:!!(null==o?void 0:o.selection)})};return null==s||s.availabilityChanged.connect(t),null==o||o.selectionChanged.connect(t),i.configChanged.connect(e),t(),()=>{null==s||s.availabilityChanged.disconnect(t),null==o||o.selectionChanged.disconnect(t),i.configChanged.disconnect(e)}}),[i]),null!==s&&a?h().createElement(_.A,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",padding:"2px 2px",marginBottom:"1em",border:"1px solid var(--jp-cell-editor-border-color)",borderTop:"none"},className:te},h().createElement(ae,{...r,className:ne}),h().createElement(le,{...r,className:ne}),h().createElement(se,{...r,className:ne}),h().createElement(ee,{value:n,className:ne})):h().createElement(h().Fragment,null)}function ae(e){const t=e.activeCellAvailable?"Insert above active cell":"Insert above active cell (no active cell)";return h().createElement(Q,{className:e.className,tooltip:t,onClick:()=>{var t;return null===(t=e.activeCellManager)||void 0===t?void 0:t.insertAbove(e.content)},disabled:!e.activeCellAvailable},h().createElement(C.addAboveIcon.react,{height:"16px",width:"16px"}))}function le(e){const t=e.activeCellAvailable?"Insert below active cell":"Insert below active cell (no active cell)";return h().createElement(Q,{className:e.className,tooltip:t,disabled:!e.activeCellAvailable,onClick:()=>{var t;return null===(t=e.activeCellManager)||void 0===t?void 0:t.insertBelow(e.content)}},h().createElement(C.addBelowIcon.react,{height:"16px",width:"16px"}))}function se(e){var t,n;const i=e.selectionExists?`Replace selection (${null===(n=null===(t=e.selectionWatcher)||void 0===t?void 0:t.selection)||void 0===n?void 0:n.numLines} line(s))`:e.activeCellAvailable?"Replace selection (active cell)":"Replace selection (no selection)",a=!e.activeCellAvailable&&!e.selectionExists;return h().createElement(Q,{className:e.className,tooltip:i,disabled:a,onClick:()=>{var t,n,i;if(e.selectionExists){const i=null===(t=e.selectionWatcher)||void 0===t?void 0:t.selection;if(!i)return;null===(n=e.selectionWatcher)||void 0===n||n.replaceSelection({...i,text:e.content})}else e.activeCellAvailable&&(null===(i=e.activeCellManager)||void 0===i||i.replace(e.content))}},h().createElement($.react,{height:"16px",width:"16px"}))}const oe="jp-chat-toolbar";function re(e){const t=[];if(void 0!==e.edit){const n=(0,C.ToolbarButtonComponent)({icon:C.editIcon,onClick:e.edit,tooltip:"Edit"});t.push(n)}if(void 0!==e.delete){const n=(0,C.ToolbarButtonComponent)({icon:C.deleteIcon,onClick:e.delete,tooltip:"Delete"});t.push(n)}return h().createElement("div",{className:oe},t.map((e=>e)))}const ce="text/markdown",de=h().memo((function(e){const t=e.appendContent||!1,[n,i]=(0,u.useState)(null),[a,l]=(0,u.useState)([]);return(0,u.useEffect)((()=>{(async()=>{var t,n;const a=e.markdownStr.replace(/\\\(/g,"\\\\(").replace(/\\\)/g,"\\\\)").replace(/\\\[/g,"\\\\[").replace(/\\\]/g,"\\\\]"),s=e.rmRegistry.createModel({data:{[ce]:a}}),o=e.rmRegistry.createRenderer(ce);if(await o.renderModel(s),null===(t=e.rmRegistry.latexTypesetter)||void 0===t||t.typeset(o.node),!o.node)throw new Error("Rendermime was unable to render Markdown content within a chat message. Please report this upstream to Jupyter chat on GitHub.");null===(n=e.rmRegistry.latexTypesetter)||void 0===n||n.typeset(o.node);const r=[];o.node.querySelectorAll("pre").forEach((t=>{var n;const i=document.createElement("div");null===(n=t.parentNode)||void 0===n||n.insertBefore(i,t.nextSibling),r.push([i,{model:e.model,content:t.textContent||""}])})),l(r),i(o.node),e.rendered.resolve()})()}),[e.markdownStr,e.rmRegistry]),h().createElement("div",{className:"jp-chat-rendered-markdown"},n&&(t?h().createElement("div",{ref:e=>e&&e.appendChild(n)}):h().createElement("div",{ref:e=>e&&e.replaceChildren(n)})),h().createElement(re,{edit:e.edit,delete:e.delete}),a.map((e=>{const[t,n]=e;return(0,q.createPortal)(h().createElement(ie,{...n}),t)})))}));function ue(e){const t=(0,u.useMemo)((()=>"jupyter-chat-scroll-container-"+Date.now().toString()),[]);return h().createElement(_.A,{id:t,sx:{overflowY:"scroll","& *":{overflowAnchor:"none"},...e.sx}},h().createElement(_.A,{sx:{minHeight:"100.01%"}},e.children),h().createElement(_.A,{sx:{overflowAnchor:"auto",height:"1px"}}))}const he="jp-chat-messages-container",me="jp-chat-message",ge="jp-chat-message-stacked",pe="jp-chat-message-header",ve="jp-chat-message-time",fe="jp-chat-writers",Ce="jp-chat-navigation",be="jp-chat-navigation-unread",_e="jp-chat-navigation-top",Ee="jp-chat-navigation-bottom";function ye(e){const{model:t}=e,[n,i]=(0,u.useState)(t.messages),a=(0,u.useRef)(null),[l,s]=(0,u.useState)([]),[o,r]=(0,u.useState)(!1),c=(0,u.useRef)([]),d=(0,u.useRef)([]);return(0,u.useEffect)((()=>{!async function(){t.getHistory&&t.getHistory().then((e=>i(e.messages))).catch((e=>console.error(e)))}(),s([])}),[t]),(0,u.useEffect)((()=>{var e;function n(){i([...t.messages])}return t.messagesUpdated.connect(n),null===(e=t.writersChanged)||void 0===e||e.connect((function(e,t){s(t)})),function(){var e;t.messagesUpdated.disconnect(n),null===(e=t.writersChanged)||void 0===e||e.disconnect(n)}}),[t]),(0,u.useEffect)((()=>{const n=new IntersectionObserver((n=>{var i;o||Promise.all(d.current.map((e=>e.promise))).then((()=>{r(!0)}));const a=[...t.unreadMessages];let l=!1;const s=[...null!==(i=t.messagesInViewport)&&void 0!==i?i:[]];n.forEach((e=>{var t;const n=parseInt(null!==(t=e.target.getAttribute("data-index"))&&void 0!==t?t:"");if(!isNaN(n)){const t=s.indexOf(n);if(e.isIntersecting||-1===t?e.isIntersecting&&-1===t&&s.push(n):s.splice(t,1),a.length){const t=a.indexOf(n);-1!==t&&e.isIntersecting&&(a.splice(t,1),l=!0)}}})),e.model.messagesInViewport=s,o&&l&&(t.unreadMessages=a)}));return c.current.forEach((e=>{e&&n.observe(e)})),()=>{c.current.forEach((e=>{e&&n.unobserve(e)}))}}),[n,o]),h().createElement(h().Fragment,null,h().createElement(ue,{sx:{flexGrow:1}},h().createElement(_.A,{ref:a,className:(0,x.A)(he)},n.map(((t,n)=>(d.current[n]=new b.PromiseDelegate,h().createElement(_.A,{key:n,className:(0,x.A)(me,t.stacked?ge:"")},h().createElement(xe,{message:t}),h().createElement(we,{...e,message:t,index:n,renderedPromise:d.current[n],ref:e=>c.current[n]=e})))))),h().createElement(Se,{writers:l})),h().createElement(ke,{...e,refMsgBox:a,allRendered:o}))}function xe(e){var t,n;const[i,a]=(0,u.useState)({}),l=e.message,s=l.sender;(0,u.useEffect)((()=>{if(!i[l.time]){const e={};let t;const n=new Date,i=e=>e.getFullYear()===n.getFullYear()&&e.getMonth()===n.getMonth()&&e.getDate()===n.getDate(),s=new Date(1e3*l.time);t=i(s)?s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):s.toLocaleString([],{day:"numeric",month:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}),e[l.time]=t,a(e)}}));const o=l.stacked?null:Ae({user:s}),r=null!==(n=null!==(t=s.display_name)&&void 0!==t?t:s.name)&&void 0!==n?n:s.username||"User undefined";return h().createElement(_.A,{className:pe,sx:{display:"flex",alignItems:"center","& > :not(:last-child)":{marginRight:3},marginBottom:l.stacked?"0px":"12px",...e.sx}},o,h().createElement(_.A,{sx:{display:"flex",flexGrow:1,flexWrap:"wrap",justifyContent:"space-between",alignItems:"center"}},h().createElement(_.A,{sx:{display:"flex",alignItems:"center"}},!l.stacked&&h().createElement(E.A,{sx:{fontWeight:700,color:"var(--jp-ui-font-color1)",paddingRight:"0.5em"}},r),(l.deleted||l.edited)&&h().createElement(E.A,{sx:{fontStyle:"italic",fontSize:"var(--jp-content-font-size0)"}},l.deleted?"(message deleted)":"(edited)")),h().createElement(E.A,{className:ve,sx:{fontSize:"0.8em",color:"var(--jp-ui-font-color2)",fontWeight:300},title:l.raw_time?"Unverified time":""},`${i[l.time]}${l.raw_time?"*":""}`)))}const we=(0,u.forwardRef)(((e,t)=>{const{message:n,model:i,rmRegistry:a}=e,[l,s]=(0,u.useState)(!1),[o,r]=(0,u.useState)(!1),[c,d]=(0,u.useState)(!1),[m,g]=(0,u.useState)(!1);return(0,u.useEffect)((()=>{var e;r(null!==(e=n.deleted)&&void 0!==e&&e),void 0===i.user||n.deleted?(d(!1),g(!1)):i.user.username===n.sender.username&&(d(void 0!==i.updateMessage),g(void 0!==i.deleteMessage))}),[i,n]),o?h().createElement("div",{ref:t,"data-index":e.index}):h().createElement("div",{ref:t,"data-index":e.index},l&&c?h().createElement(K,{value:n.body,onSend:e=>((e,t)=>{if(!c)return;const a={...n};a.body=t,i.updateMessage(e,a),s(!1)})(n.id,e),onCancel:()=>{s(!1)},model:i,hideIncludeSelection:!0}):h().createElement(de,{rmRegistry:a,markdownStr:n.body,model:i,edit:c?()=>s(!0):void 0,delete:m?()=>{return e=n.id,void(m&&i.deleteMessage(e));var e}:void 0,rendered:e.renderedPromise}))}));function Se(e){const{writers:t}=e;return t.length>0?h().createElement(_.A,{className:fe},t.map(((e,n)=>{var i,a;return h().createElement("div",null,h().createElement(Ae,{user:e,small:!0}),h().createElement("span",null,null!==(a=null!==(i=e.display_name)&&void 0!==i?i:e.name)&&void 0!==a?a:e.username||"User undefined"),h().createElement("span",null,n<t.length-1?n<t.length-2?", ":" and ":""))})),h().createElement("span",null,(t.length>1?" are":" is")+" writing")):null}function ke(e){const{model:t}=e,[n,i]=(0,u.useState)(!0),[a,l]=(0,u.useState)(null),[s,o]=(0,u.useState)(null),r=(t,n=!0)=>{var i,a;null===(a=null===(i=e.refMsgBox.current)||void 0===i?void 0:i.children.item(t))||void 0===a||a.scrollIntoView(n)};return(0,u.useEffect)((()=>{var n;if(!e.allRendered)return;const i=(e,t)=>{const n=e.messagesInViewport;if(!n)return;let i=null!==a&&t.includes(a)&&a<Math.min(...n)?a:null,r=null!==s&&t.includes(s)&&s>Math.max(...n)?s:null;t.forEach((t=>{(null==n?void 0:n.includes(t))||(t<(null!=i?i:Math.min(...n))?i=t:t>Math.max(...n)&&t<(null!=r?r:e.messages.length)&&(r=t))})),l(i),o(r)};return null===(n=t.unreadChanged)||void 0===n||n.connect(i),i(t,t.unreadMessages),r(t.messages.length-1,!1),()=>{var e;null===(e=t.unreadChanged)||void 0===e||e.disconnect(i)}}),[t,e.allRendered]),(0,u.useEffect)((()=>{var e,n;const a=(e,t)=>{i(t.includes(e.messages.length-1))};return null===(e=t.viewportChanged)||void 0===e||e.connect(a),a(t,null!==(n=t.messagesInViewport)&&void 0!==n?n:[]),()=>{var e;null===(e=t.viewportChanged)||void 0===e||e.disconnect(a)}}),[t]),h().createElement(h().Fragment,null,null!==a&&h().createElement(f.Button,{className:`${Ce} ${be} ${_e}`,onClick:()=>r(a),title:"Go to unread messages"},h().createElement(C.LabIcon.resolveReact,{display:"flex",icon:C.caretDownEmptyIcon,iconClass:(0,C.classes)("jp-Icon")})),(null!==s||!n)&&h().createElement(f.Button,{className:`${Ce} ${null!==s?be:""} ${Ee}`,onClick:null===s?()=>r(t.messages.length-1,!1):()=>r(s),title:null!==s?"Go to unread messages":"Go to last message"},h().createElement(C.LabIcon.resolveReact,{display:"flex",icon:C.caretDownEmptyIcon,iconClass:(0,C.classes)("jp-Icon")})))}function Ae(e){var t,n;const{user:i}=e,a={height:(e.small?"16":"24")+"px",width:(e.small?"16":"24")+"px",bgcolor:i.color,fontSize:`var(--jp-ui-font-size${e.small?"0":"1"})`},l=null!==(n=null!==(t=i.display_name)&&void 0!==t?t:i.name)&&void 0!==n?n:i.username||"User undefined";return i.avatar_url?h().createElement(y.A,{sx:{...a},src:i.avatar_url,alt:l,title:l}):i.initials?h().createElement(y.A,{sx:{...a},alt:l,title:l},h().createElement(E.A,{sx:{fontSize:`var(--jp-ui-font-size${e.small?"0":"1"})`,color:"var(--jp-ui-inverse-font-color1)"}},i.initials)):null}function Me(e){const{model:t,rmRegistry:n,autocompletionRegistry:i}=e;return h().createElement(h().Fragment,null,h().createElement(ye,{rmRegistry:n,model:t}),h().createElement(K,{onSend:async e=>{t.sendMessage({body:e})},sx:{paddingLeft:4,paddingRight:4,paddingTop:3.5,paddingBottom:0,borderTop:"1px solid var(--jp-border-color1)"},model:t,autocompletionRegistry:i}))}function Ie(e){var t;const[n,i]=(0,u.useState)(e.chatView||Ie.View.chat);return h().createElement(v,{themeManager:null!==(t=e.themeManager)&&void 0!==t?t:null},h().createElement(d.A,{className:"jp-ThemedContainer",sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},h().createElement(d.A,{sx:{display:"flex",justifyContent:"space-between"}},n!==Ie.View.chat?h().createElement(c.A,{onClick:()=>i(Ie.View.chat)},h().createElement(o.A,null)):h().createElement(d.A,null),n!==Ie.View.settings&&e.settingsPanel?h().createElement(c.A,{onClick:()=>i(Ie.View.settings)},h().createElement(r.A,null)):h().createElement(d.A,null)),n===Ie.View.chat&&h().createElement(Me,{model:e.model,rmRegistry:e.rmRegistry,autocompletionRegistry:e.autocompletionRegistry}),n===Ie.View.settings&&e.settingsPanel&&h().createElement(e.settingsPanel,null)))}!function(e){let t;!function(e){e[e.chat=0]="chat",e[e.settings=1]="settings"}(t=e.View||(e.View={}))}(Ie||(Ie={}));class je{constructor(e={}){var t,n,i;this._messages=[],this._unreadMessages=[],this._messagesInViewport=[],this._name="",this._isDisposed=!1,this._notificationId=null,this._messagesUpdated=new l.Signal(this),this._configChanged=new l.Signal(this),this._unreadChanged=new l.Signal(this),this._viewportChanged=new l.Signal(this),this._writersChanged=new l.Signal(this),this._focusInputSignal=new l.Signal(this),e.id&&(this.id=e.id);const a=null!==(t=e.config)&&void 0!==t?t:{};this._config={stackMessages:!0,sendTypingNotification:!0,...a},this._commands=e.commands,this._activeCellManager=null!==(n=e.activeCellManager)&&void 0!==n?n:null,this._selectionWatcher=null!==(i=e.selectionWatcher)&&void 0!==i?i:null}get id(){return this._id}set id(e){this._id=e}get name(){return this._name}set name(e){this._name=e}get messages(){return this._messages}get activeCellManager(){return this._activeCellManager}get selectionWatcher(){return this._selectionWatcher}get lastRead(){var e;return void 0===this._id?0:null!==(e=JSON.parse(localStorage.getItem(`@jupyter/chat:${this._id}`)||"{}").lastRead)&&void 0!==e?e:0}set lastRead(e){if(void 0===this._id)return;const t=JSON.parse(localStorage.getItem(`@jupyter/chat:${this._id}`)||"{}");t.lastRead=e,localStorage.setItem(`@jupyter/chat:${this._id}`,JSON.stringify(t))}get config(){return this._config}set config(e){const t="stackMessages"in e&&this._config.stackMessages!==e.stackMessages,n="unreadNotifications"in e&&this._config.unreadNotifications!==e.unreadNotifications;this._config={...this._config,...e},this._configChanged.emit(this._config),t&&(this._config.stackMessages?this._messages.slice(1).forEach(((e,t)=>{const n=this._messages[t].sender.username;e.stacked=n===e.sender.username})):this._messages.forEach((e=>{delete e.stacked})),this._messagesUpdated.emit()),n&&!this._config.unreadNotifications&&this._notify(0)}get unreadMessages(){return this._unreadMessages}set unreadMessages(e){var t;const n=this._unreadMessages.filter((t=>!e.includes(t))),i=e.length-this._unreadMessages.length;if(this._unreadMessages=e,this._unreadChanged.emit(this._unreadMessages),this._notify(e.length,i>0),void 0!==this._id&&n.length){let e=!1,i=null!==(t=this.lastRead)&&void 0!==t?t:this.messages[n[0]].time;n.forEach((t=>{this.messages[t].time>i&&(i=this.messages[t].time,e=!0)})),e&&(this.lastRead=i)}}get messagesInViewport(){return this._messagesInViewport}set messagesInViewport(e){this._messagesInViewport=e,this._viewportChanged.emit(e)}get messagesUpdated(){return this._messagesUpdated}get configChanged(){return this._configChanged}get unreadChanged(){return this._unreadChanged}get viewportChanged(){return this._viewportChanged}get writersChanged(){return this._writersChanged}get focusInputSignal(){return this._focusInputSignal}sendMessage(e){}dispose(){this.isDisposed||(this._isDisposed=!0)}get isDisposed(){return this._isDisposed}formatChatMessage(e){return e}messageAdded(e){const t=this._messages.findIndex((t=>t.id===e.id));t>-1&&this._messages.splice(t,1);let n=this._messages.findIndex((t=>t.time>e.time));-1===n&&(n=this._messages.length),this.messagesInserted(n,[e])}messagesInserted(e,t){var n;const i=[],a=[],l=null!==(n=this.lastRead)&&void 0!==n?n:0;if(t.forEach(((t,n)=>{i.push(this.formatChatMessage(t)),t.time>l&&a.push(e+n)})),this._messages.splice(e,0,...i),this._config.stackMessages){const t=e+i.length-1,n=0===e?1:e,a=this._messages.length>t+1?t+1:t;for(let e=n;e<=a;e++){const t=this._messages[e],n=this._messages[e-1].sender.username;t.stacked=n===t.sender.username}}this._addUnreadMessages(a),this._messagesUpdated.emit()}messagesDeleted(e,t){this._messages.splice(e,t),this._messagesUpdated.emit()}updateWriters(e){this._writersChanged.emit(e)}focusInput(){this._focusInputSignal.emit()}inputChanged(e){}_addUnreadMessages(e){const t=new Set(this._unreadMessages);e.forEach((e=>t.add(e))),this.unreadMessages=Array.from(t.values())}_notify(e,t=!1){this._commands&&(e&&this._config.unreadNotifications?this._commands.execute("apputils:update-notification",{id:this._notificationId,message:`${e} incoming message(s) ${this._name?"in "+this._name:""}`}).then((n=>{!n&&t&&this._commands.execute("apputils:notify",{type:"info",message:`${e} incoming message(s) in ${this._name}`}).then((e=>{this._notificationId=e}))})):this._notificationId&&(this._commands.execute("apputils:dismiss-notification",{id:this._notificationId}),this._notificationId=null))}}const Re=new b.Token("@jupyter/chat:IAutocompleteRegistry");class Ne{constructor(){this._default=null,this._autocompletions=new Map}get default(){return this._default}set default(e){null===e||this._autocompletions.has(e)?this._default=e:console.warn(`There is no registered completer with the name '${e}'`)}getDefaultCompletion(){if(null!==this._default)return this._autocompletions.get(this._default)}get(e){return this._autocompletions.get(e)}add(e,t,n=!1){return this._autocompletions.has(e)?(console.warn(`A completer with the name '${e}' is already registered`),!1):(this._autocompletions.set(e,t),(1===this._autocompletions.size||n)&&(this.default=e),!0)}remove(e){return this._autocompletions.delete(e)}removeAll(){this._autocompletions.clear()}}var Ve=n(9963),Te=n(4053),We=n(7781),Pe=n(5810);function Le(e){var t;if(!(e instanceof Ve.DocumentWidget))return null;let n;const{content:i}=e;return i instanceof Pe.FileEditor?n=i.editor:i instanceof a.Notebook&&(n=null===(t=i.activeCell)||void 0===t?void 0:t.editor),n instanceof We.CodeMirrorEditor?n:void 0}class De{constructor(e){var t;this._mainAreaDocumentWidget=null,this._selection=null,this._selectionChanged=new l.Signal(this),this._shell=e.shell,null===(t=this._shell.currentChanged)||void 0===t||t.connect(((e,t)=>{var n;const i=t.newValue;if(null===i)return void(this._mainAreaDocumentWidget=null);const l=Le(i);i instanceof Ve.DocumentWidget&&(l||i.content instanceof a.Notebook)?this._mainAreaDocumentWidget=i:(null===(n=this._mainAreaDocumentWidget)||void 0===n?void 0:n.isDisposed)&&(this._mainAreaDocumentWidget=null)})),setInterval(this._poll.bind(this),200)}get selection(){return this._selection}get selectionChanged(){return this._selectionChanged}replaceSelection(e){const t=(0,Te.find)(this._shell.widgets(),(t=>t.id===e.widgetId));if(!((null==t?void 0:t.isVisible)&&t instanceof Ve.DocumentWidget))return;if(this._shell.activateById(e.widgetId),t.content instanceof a.Notebook&&e.cellId){const n=function(e,t){var n;const i=null===(n=e.model)||void 0===n?void 0:n.sharedModel.cells.findIndex((e=>e.getId()===t));return void 0===i?-1:i}(t.content,e.cellId);-1!==n&&(t.content.activeCellIndex=n)}const n=Le(t);if(!n)return;n.model.sharedModel.updateSource(n.getOffsetAt(e.start),n.getOffsetAt(e.end),e.text);const i=n.getPositionAt(n.getOffsetAt(e.start)+e.text.length);n.setSelection({start:i,end:i})}_poll(){var e;let t=null;const n=this._selection;(null===(e=this._mainAreaDocumentWidget)||void 0===e?void 0:e.isVisible)&&(t=function(e){var t;const n=Le(e);if(!(n&&e instanceof Ve.DocumentWidget))return null;let i;e.content instanceof a.Notebook&&(i=null===(t=e.content.activeCell)||void 0===t?void 0:t.model.id);const l=n.getSelection();let{start:s,end:o}=l;const r=n.getOffsetAt(s),c=n.getOffsetAt(o),d=n.model.sharedModel.getSource().substring(r,c);return d?(r>c&&([s,o]=[o,s]),{...l,start:s,end:o,text:d,numLines:d.split("\n").length,widgetId:e.id,...i&&{cellId:i}}):null}(this._mainAreaDocumentWidget)),(null==n?void 0:n.text)!==(null==t?void 0:t.text)&&(this._selection=t,this._selectionChanged.emit(t))}}var He=n(9594),Be=n(9276);function ze(e){const t=He.ReactWidget.create(h().createElement(v,{themeManager:e},h().createElement(_.A,{sx:{width:"100%",height:"100%",boxSizing:"border-box",background:"var(--jp-layout-color0)",display:"flex",flexDirection:"column"}},h().createElement(_.A,{sx:{padding:4}},h().createElement(Be.A,{severity:"error"},"There seems to be a problem with the Chat backend, please look at the JupyterLab server logs or contact your administrator to correct this problem.")))));return t.id="jupyter-chat::chat",t.title.icon=B,t.title.caption="Jupyter Chat",t}function $e(e){const t=He.ReactWidget.create(h().createElement(Ie,{...e}));return t.id="jupyter-chat::side-panel",t.title.icon=B,t.title.caption="Jupyter Chat",t}class Oe extends He.ReactWidget{constructor(e){super(),this.id="jupyter-chat::widget",this.title.icon=B,this.title.caption="Jupyter Chat",this._chatOptions=e}get model(){return this._chatOptions.model}render(){return h().createElement(Ie,{...this._chatOptions,model:this._chatOptions.model})}}}}]);