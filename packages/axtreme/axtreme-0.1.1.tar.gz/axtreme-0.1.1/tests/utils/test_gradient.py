import matplotlib.pyplot as plt
import pytest
import torch

from axtreme.utils.gradient import is_smooth_1d


def test_is_smooth_1d_extreme_but_acceptable(*, visualise: bool = False):
    """Pick a function that is has rapidly changing gradient, but is smooth."""
    x = torch.linspace(0, 1, 1000)
    y = torch.sin(50 * x.flatten())

    if visualise:
        _ = plt.plot(x, y)
        plt.pause(5)

    _ = is_smooth_1d(x, y, plot=visualise)


def test_is_smooth_1d_real_non_smooth_acquition_function(*, visualise: bool = False):
    """A real example of an acquisition function that was producing non-smooth results"""
    x = torch.linspace(0, 1, 1000)
    # fmt: off
    y = torch.tensor([-1.2732, -1.2732, -1.2732, -1.2732, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2731,-1.2731, -1.2731, -1.2731, -1.2730, -1.2730, -1.2730, -1.2730, -1.2729,-1.2729, -1.2729, -1.2728, -1.2728, -1.2727, -1.2727, -1.2726, -1.2726,-1.2725, -1.2725, -1.2725, -1.2724, -1.2724, -1.2723, -1.2723, -1.2722,-1.2722, -1.2721, -1.2721, -1.2720, -1.2720, -1.2719, -1.2719, -1.2718,-1.2718, -1.2718, -1.2717, -1.2717, -1.2716, -1.2716, -1.2715, -1.2715,-1.2715, -1.2714, -1.2714, -1.2713, -1.2713, -1.2713, -1.2712, -1.2712,-1.2712, -1.2712, -1.2711, -1.2711, -1.2711, -1.2711, -1.2710, -1.2710,-1.2710, -1.2710, -1.2710, -1.2710, -1.2710, -1.2710, -1.2710, -1.2710,-1.2710, -1.2710, -1.2710, -1.2710, -1.2710, -1.2710, -1.2710, -1.2710,-1.2711, -1.2711, -1.2711, -1.2711, -1.2712, -1.2712, -1.2712, -1.2713,-1.2716, -1.2716, -1.2717, -1.2717, -1.2718, -1.2718, -1.2718, -1.2719,-1.2719, -1.2720, -1.2720, -1.2721, -1.2721, -1.2722, -1.2722, -1.2723,-1.2723, -1.2724, -1.2724, -1.2725, -1.2725, -1.2726, -1.2726, -1.2727,-1.2727, -1.2728, -1.2728, -1.2729, -1.2729, -1.2730, -1.2730, -1.2730,-1.2731, -1.2731, -1.2731, -1.2731, -1.2732, -1.2732, -1.2732, -1.2732,-1.2732, -1.2732, -1.2732, -1.2732, -1.2731, -1.2731, -1.2731, -1.2730,-1.2730, -1.2729, -1.2728, -1.2727, -1.2726, -1.2725, -1.2724, -1.2723,-1.2721, -1.2720, -1.2718, -1.2716, -1.2715, -1.2712, -1.2710, -1.2708,-1.2705, -1.2702, -1.2700, -1.2696, -1.2693, -1.2690, -1.2686, -1.2682,-1.2678, -1.2674, -1.2669, -1.2664, -1.2659, -1.2654, -1.2649, -1.2643,-1.2637, -1.2631, -1.2624, -1.2617, -1.2610, -1.2603, -1.2595, -1.2587,-1.2579, -1.2571, -1.2562, -1.2553, -1.2543, -1.2533, -1.2523, -1.2513,-1.2502, -1.2491, -1.2479, -1.2467, -1.2455, -1.2443, -1.2430, -1.2417,-1.2403, -1.2389, -1.2375, -1.2360, -1.2268, -1.2250, -1.2231, -1.2212,-1.2192, -1.2172, -1.2151, -1.2130, -1.2108, -1.2086, -1.2064, -1.2041,-1.2018, -1.1994, -1.1970, -1.1945, -1.1920, -1.1895, -1.1869, -1.1843,-1.1816, -1.1789, -1.1761, -1.1734, -1.1705, -1.1677, -1.1648, -1.1618,-1.1589, -1.1559, -1.1528, -1.1498, -1.1467, -1.1435, -1.1403, -1.1372,-1.1339, -1.1307, -1.1274, -1.1241, -1.1208, -1.1174, -1.1140, -1.1106,-1.1072, -1.1038, -1.1003, -1.0969, -1.0934, -1.0899, -1.0864, -1.0829,-1.0794, -1.0758, -1.0723, -1.0688, -1.0652, -1.0617, -1.0581, -1.0546,-1.0511, -1.0475, -1.0440, -1.0405, -1.0370, -1.0335, -1.0300, -1.0266,-1.0232, -1.0197, -1.0163, -1.0130, -1.0096, -1.0063, -1.0030, -0.9998,-0.9966, -0.9934, -0.9902, -0.9871, -0.9841, -0.9811, -0.9781, -0.9752,-0.9723, -0.9875, -0.9848, -0.9823, -1.0522, -1.0504, -1.0486, -1.0468,-1.0451, -1.0434, -1.0418, -1.0402, -1.0387, -1.0372, -1.0358, -1.0345,-1.0332, -1.0319, -1.0307, -1.0296, -1.0285, -1.0275, -1.0266, -1.0257,-1.0249, -1.0241, -1.0235, -1.0228, -1.0223, -1.0218, -1.0214, -1.0210,-1.0207, -1.0205, -1.0204, -1.0203, -1.0203, -1.0203, -1.0205, -1.0206,-1.0209, -1.0212, -1.0216, -1.0221, -1.0226, -1.0232, -1.0239, -1.0247,-1.0255, -1.0263, -1.0273, -1.0282, -1.0293, -1.0304, -1.0316, -1.0328,-1.0341, -1.0355, -1.0369, -1.0384, -1.0399, -1.0415, -1.0431, -1.0448,-1.0465, -1.0483, -1.0501, -1.0519, -1.0539, -1.0558, -1.0578, -1.0598,-1.0619, -1.0640, -1.0661, -1.0683, -1.0705, -1.0727, -1.0750, -1.0773,-1.0796, -1.0819, -1.0843, -1.0866, -1.0890, -1.0915, -1.0939, -1.0963,-1.0988, -1.1012, -1.1037, -1.1062, -1.1087, -1.1112, -1.1137, -1.1162,-1.1187, -1.1212, -1.1237, -1.1262, -1.1287, -1.1312, -1.1337, -1.1362,-1.1386, -1.1411, -1.1435, -1.1460, -1.1484, -1.1508, -1.1532, -1.1556,-1.1580, -1.1603, -1.1626, -1.1649, -1.1672, -1.1695, -1.1717, -1.1740,-1.1762, -1.1783, -1.1805, -1.1826, -1.1847, -1.1868, -1.1889, -1.1909,-1.1929, -1.1949, -1.1968, -1.1988, -1.2007, -1.2025, -1.2044, -1.2062,-1.2080, -1.2097, -1.2114, -1.2131, -1.2148, -1.2164, -1.2181, -1.2196,-1.2212, -1.2227, -1.2242, -1.2257, -1.2271, -1.2285, -1.2299, -1.2312,-1.2326, -1.2339, -1.2351, -1.2364, -1.2376, -1.2388, -1.2399, -1.2411,-1.2422, -1.2432, -1.2443, -1.2453, -1.2463, -1.2473, -1.2482, -1.2492,-1.2501, -1.2510, -1.2518, -1.2526, -1.2535, -1.2542, -1.2550, -1.2557,-1.2565, -1.2572, -1.2579, -1.2585, -1.2575, -1.2582, -1.2589, -1.2595,-1.2601, -1.2607, -1.2613, -1.2619, -1.2625, -1.2630, -1.2635, -1.2640,-1.2645, -1.2649, -1.2654, -1.2658, -1.2662, -1.2666, -1.2670, -1.2673,-1.2677, -1.2680, -1.2683, -1.2686, -1.2689, -1.2692, -1.2695, -1.2697,-1.2700, -1.2702, -1.2704, -1.2706, -1.2708, -1.2710, -1.2712, -1.2714,-1.2715, -1.2717, -1.2718, -1.2719, -1.2721, -1.2722, -1.2723, -1.2724,-1.2725, -1.2726, -1.2727, -1.2727, -1.2728, -1.2729, -1.2729, -1.2730,-1.2730, -1.2731, -1.2731, -1.2731, -1.2732, -1.2732, -1.2732, -1.2732,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732,-1.2731, -1.2731, -1.2731, -1.2731, -1.2730, -1.2730, -1.2730, -1.2730,-1.2729, -1.2729, -1.2729, -1.2729, -1.2728, -1.2728, -1.2728, -1.2728,-1.2727, -1.2727, -1.2727, -1.2726, -1.2726, -1.2726, -1.2726, -1.2725,-1.2725, -1.2725, -1.2725, -1.2725, -1.2724, -1.2724, -1.2724, -1.2724,-1.2724, -1.2723, -1.2723, -1.2723, -1.2723, -1.2723, -1.2723, -1.2722,-1.2722, -1.2722, -1.2722, -1.2722, -1.2722, -1.2722, -1.2722, -1.2721,-1.2721, -1.2721, -1.2721, -1.2721, -1.2721, -1.2721, -1.2721, -1.2721,-1.2721, -1.2721, -1.2721, -1.2721, -1.2721, -1.2721, -1.2721, -1.2721,-1.2721, -1.2721, -1.2721, -1.2721, -1.2721, -1.2721, -1.2724, -1.2724,-1.2724, -1.2724, -1.2725, -1.2725, -1.2725, -1.2725, -1.2725, -1.2725,-1.2725, -1.2725, -1.2725, -1.2725, -1.2725, -1.2725, -1.2725, -1.2725,-1.2726, -1.2726, -1.2726, -1.2726, -1.2726, -1.2726, -1.2726, -1.2726,-1.2726, -1.2726, -1.2726, -1.2727, -1.2727, -1.2727, -1.2727, -1.2727,-1.2727, -1.2727, -1.2727, -1.2727, -1.2727, -1.2728, -1.2728, -1.2728,-1.2728, -1.2728, -1.2728, -1.2728, -1.2728, -1.2728, -1.2728, -1.2728,-1.2729, -1.2729, -1.2729, -1.2729, -1.2729, -1.2729, -1.2729, -1.2729,-1.2729, -1.2729, -1.2729, -1.2730, -1.2730, -1.2730, -1.2730, -1.2730,-1.2730, -1.2730, -1.2730, -1.2730, -1.2730, -1.2730, -1.2730, -1.2730,-1.2731, -1.2731, -1.2731, -1.2731, -1.2731, -1.2731, -1.2731, -1.2731,-1.2731, -1.2731, -1.2731, -1.2731, -1.2731, -1.2731, -1.2731, -1.2731,-1.2731, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732,-1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732,-1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732,-1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732, -1.2732,-1.2732, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733,-1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733, -1.2733])  # noqa: E501
    # fmt: on
    if visualise:
        _ = plt.plot(x, y)
        plt.pause(5)

    with pytest.raises(AssertionError, match=".*not smooth.*"):
        _ = is_smooth_1d(x, y, plot=visualise)
