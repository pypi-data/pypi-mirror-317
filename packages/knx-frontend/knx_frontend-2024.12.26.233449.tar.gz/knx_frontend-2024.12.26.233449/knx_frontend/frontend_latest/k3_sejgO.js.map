{"version":3,"file":"k3_sejgO.js","mappings":";;;;AAmGA;AACA;AACA;AACA;;;AAIA;AACA;;;;AAIA;;;;;;AAMA;;;;;;AAOA","sources":["webpack://knx-frontend/mwc-linear-progress-base.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Style preference for leading underscores.\n// tslint:disable:strip-private-property-underscore\n\nimport {MDCResizeObserver, WithMDCResizeObserver} from '@material/linear-progress/types.js';\nimport {ariaProperty} from '@material/mwc-base/aria-property.js';\nimport {html, LitElement, PropertyValues, TemplateResult} from 'lit';\nimport {property, query, state} from 'lit/decorators.js';\nimport {classMap} from 'lit/directives/class-map.js';\nimport {ifDefined} from 'lit/directives/if-defined.js';\nimport {styleMap} from 'lit/directives/style-map.js';\n\n/** @soyCompatible */\nexport class LinearProgressBase extends LitElement {\n  @query('.mdc-linear-progress') protected rootEl!: HTMLElement;\n\n  @property({type: Boolean, reflect: true}) indeterminate = false;\n\n  @property({type: Number}) progress = 0;\n\n  @property({type: Number}) buffer = 1;\n\n  @property({type: Boolean, reflect: true}) reverse = false;\n\n  @property({type: Boolean, reflect: true}) closed = false;\n\n  /** @soyPrefixAttribute */\n  @ariaProperty\n  @property({attribute: 'aria-label'})\n  override ariaLabel!: string;\n\n  @state() protected stylePrimaryHalf = '';\n  @state() protected stylePrimaryFull = '';\n  @state() protected styleSecondaryQuarter = '';\n  @state() protected styleSecondaryHalf = '';\n  @state() protected styleSecondaryFull = '';\n  @state() protected animationReady = true;\n  @state() protected closedAnimationOff = false;\n  protected resizeObserver: MDCResizeObserver|null = null;\n\n  override connectedCallback() {\n    super.connectedCallback();\n    // if detached and reattached\n    if (this.rootEl) {\n      this.attachResizeObserver();\n    }\n  }\n\n  /**\n   * @soyTemplate\n   */\n  protected override render(): TemplateResult {\n    /** @classMap */\n    const classes = {\n      'mdc-linear-progress--closed': this.closed,\n      'mdc-linear-progress--closed-animation-off': this.closedAnimationOff,\n      'mdc-linear-progress--indeterminate': this.indeterminate,\n      // needed for controller-less render\n      'mdc-linear-progress--animation-ready': this.animationReady\n    };\n\n    /** @styleMap */\n    const rootStyles = {\n      '--mdc-linear-progress-primary-half': this.stylePrimaryHalf,\n      '--mdc-linear-progress-primary-half-neg':\n          this.stylePrimaryHalf !== '' ? `-${this.stylePrimaryHalf}` : '',\n      '--mdc-linear-progress-primary-full': this.stylePrimaryFull,\n      '--mdc-linear-progress-primary-full-neg':\n          this.stylePrimaryFull !== '' ? `-${this.stylePrimaryFull}` : '',\n      '--mdc-linear-progress-secondary-quarter': this.styleSecondaryQuarter,\n      '--mdc-linear-progress-secondary-quarter-neg':\n          this.styleSecondaryQuarter !== '' ? `-${this.styleSecondaryQuarter}` :\n                                              '',\n      '--mdc-linear-progress-secondary-half': this.styleSecondaryHalf,\n      '--mdc-linear-progress-secondary-half-neg':\n          this.styleSecondaryHalf !== '' ? `-${this.styleSecondaryHalf}` : '',\n      '--mdc-linear-progress-secondary-full': this.styleSecondaryFull,\n      '--mdc-linear-progress-secondary-full-neg':\n          this.styleSecondaryFull !== '' ? `-${this.styleSecondaryFull}` : '',\n    };\n\n    /** @styleMap */\n    const bufferBarStyles = {\n      'flex-basis': this.indeterminate ? '100%' : `${this.buffer * 100}%`,\n    };\n\n    /** @styleMap */\n    const primaryBarStyles = {\n      transform: this.indeterminate ? 'scaleX(1)' : `scaleX(${this.progress})`,\n    };\n\n    return html`\n      <div\n          role=\"progressbar\"\n          class=\"mdc-linear-progress ${classMap(classes)}\"\n          style=\"${styleMap(rootStyles)}\"\n          dir=\"${ifDefined(this.reverse ? 'rtl' : undefined)}\"\n          aria-label=\"${ifDefined(this.ariaLabel)}\"\n          aria-valuemin=\"0\"\n          aria-valuemax=\"1\"\n          aria-valuenow=\"${\n        ifDefined(this.indeterminate ? undefined : this.progress)}\"\n        @transitionend=\"${this.syncClosedState}\">\n        <div class=\"mdc-linear-progress__buffer\">\n          <div\n            class=\"mdc-linear-progress__buffer-bar\"\n            style=${styleMap(bufferBarStyles)}>\n          </div>\n          <div class=\"mdc-linear-progress__buffer-dots\"></div>\n        </div>\n        <div\n            class=\"mdc-linear-progress__bar mdc-linear-progress__primary-bar\"\n            style=${styleMap(primaryBarStyles)}>\n          <span class=\"mdc-linear-progress__bar-inner\"></span>\n        </div>\n        <div class=\"mdc-linear-progress__bar mdc-linear-progress__secondary-bar\">\n          <span class=\"mdc-linear-progress__bar-inner\"></span>\n        </div>\n      </div>`;\n  }\n\n  override update(changedProperties: PropertyValues<this>) {\n    // - When showing the indicator, enable animations immediately.\n    // - On first render, disable the animation immediately.\n    // - For normal calls to hide the component, let transitionend event trigger\n    //   disabling of animations instead (see render method), so that animation\n    //   does not jump in the middle of fade out.\n    if (changedProperties.has('closed') &&\n        (!this.closed || changedProperties.get('closed') === undefined)) {\n      this.syncClosedState();\n    }\n    super.update(changedProperties);\n  }\n\n  override async firstUpdated(changed: PropertyValues<this>) {\n    super.firstUpdated(changed);\n\n    this.attachResizeObserver();\n  }\n\n  protected syncClosedState() {\n    this.closedAnimationOff = this.closed;\n  }\n\n  protected override updated(changed: PropertyValues<this>) {\n    // restart animation for timing if reverse changed and is indeterminate.\n    // don't restart here if indeterminate has changed as well because we don't\n    // want to incur an extra style recalculation\n    if (!changed.has('indeterminate') && changed.has('reverse') &&\n        this.indeterminate) {\n      this.restartAnimation();\n    }\n\n    // Recaclulate the animation css custom props and restart the calculation\n    // if this is not the first render cycle, otherwise, resize observer init\n    // will already handle this and prevent unnecessary rerender + style recalc\n    // but resize observer will not update animation vals while determinate\n    if (changed.has('indeterminate') &&\n        changed.get('indeterminate') !== undefined && this.indeterminate &&\n        (window as unknown as WithMDCResizeObserver).ResizeObserver) {\n      this.calculateAndSetAnimationDimensions(this.rootEl.offsetWidth);\n    }\n    super.updated(changed);\n  }\n\n  override disconnectedCallback() {\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n      this.resizeObserver = null;\n    }\n    super.disconnectedCallback();\n  }\n\n  protected attachResizeObserver() {\n    if ((window as unknown as WithMDCResizeObserver).ResizeObserver) {\n      this.resizeObserver =\n          new (window as unknown as WithMDCResizeObserver)\n              .ResizeObserver((entries) => {\n                if (!this.indeterminate) {\n                  return;\n                }\n\n                for (const entry of entries) {\n                  if (entry.contentRect) {\n                    const width = entry.contentRect.width;\n                    this.calculateAndSetAnimationDimensions(width);\n                  }\n                }\n              });\n      this.resizeObserver.observe(this.rootEl);\n      return;\n    }\n\n    this.resizeObserver = null;\n  }\n\n  protected calculateAndSetAnimationDimensions(width: number) {\n    const primaryHalf = width * 0.8367142;\n    const primaryFull = width * 2.00611057;\n    const secondaryQuarter = width * 0.37651913;\n    const secondaryHalf = width * 0.84386165;\n    const secondaryFull = width * 1.60277782;\n\n    this.stylePrimaryHalf = `${primaryHalf}px`;\n    this.stylePrimaryFull = `${primaryFull}px`;\n    this.styleSecondaryQuarter = `${secondaryQuarter}px`;\n    this.styleSecondaryHalf = `${secondaryHalf}px`;\n    this.styleSecondaryFull = `${secondaryFull}px`;\n\n    // need to restart animation for custom props to apply to keyframes\n    this.restartAnimation();\n  }\n\n  protected async restartAnimation() {\n    this.animationReady = false;\n    await this.updateComplete;\n    await new Promise(requestAnimationFrame);\n    this.animationReady = true;\n    await this.updateComplete;\n  }\n\n  open() {\n    this.closed = false;\n  }\n\n  close() {\n    this.closed = true;\n  }\n}\n"],"names":[],"sourceRoot":""}