"use strict";(self.webpackChunkknx_frontend=self.webpackChunkknx_frontend||[]).push([[9123],{29123:function(e,t,i){var s,n,r,a,l,o,u,d,h=i(94881),c=i(1781),_=i(6238),v=i(36683),p=i(89231),f=i(29864),k=i(83647),w=i(8364),b=i(27526),y=(i(77052),i(36724),i(14460),i(98168),i(98597)),m=i(196),g=i(11355),A=(i(43859),i(72266),i(33167));i(91074),(0,w.A)([(0,m.EM)("flow-preview-template")],(function(e,t){var i,w=function(t){function i(){var t;(0,p.A)(this,i);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return t=(0,f.A)(this,i,[].concat(n)),e(t),t}return(0,k.A)(i,t),(0,v.A)(i)}(t);return{F:w,d:[{kind:"field",decorators:[(0,m.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,m.MZ)()],key:"flowType",value:void 0},{kind:"field",key:"handler",value:void 0},{kind:"field",decorators:[(0,m.MZ)()],key:"stepId",value:void 0},{kind:"field",decorators:[(0,m.MZ)()],key:"flowId",value:void 0},{kind:"field",decorators:[(0,m.MZ)({attribute:!1})],key:"stepData",value:void 0},{kind:"field",decorators:[(0,m.wk)()],key:"_preview",value:void 0},{kind:"field",decorators:[(0,m.wk)()],key:"_listeners",value:void 0},{kind:"field",decorators:[(0,m.wk)()],key:"_error",value:void 0},{kind:"field",key:"_unsub",value:void 0},{kind:"method",key:"disconnectedCallback",value:function(){(0,b.A)(w,"disconnectedCallback",this,3)([]),this._unsub&&(this._unsub.then((function(e){return e()})),this._unsub=void 0)}},{kind:"method",key:"willUpdate",value:function(e){e.has("stepData")&&this._debouncedSubscribePreview()}},{kind:"method",key:"render",value:function(){var e,t=this;return this._error?(0,y.qy)(s||(s=(0,_.A)(['<ha-alert alert-type="error">',"</ha-alert>"])),this._error):(0,y.qy)(n||(n=(0,_.A)(["<entity-preview-row\n        .hass=","\n        .stateObj=","\n      ></entity-preview-row>\n      ","\n      "," "])),this.hass,this._preview,null!==(e=this._listeners)&&void 0!==e&&e.time?(0,y.qy)(r||(r=(0,_.A)(["\n            <p>\n              ","\n            </p>\n          "])),this.hass.localize("ui.dialogs.helper_settings.template.time")):y.s6,this._listeners?this._listeners.all?(0,y.qy)(a||(a=(0,_.A)(['\n              <p class="all_listeners">\n                ',"\n              </p>\n            "])),this.hass.localize("ui.dialogs.helper_settings.template.all_listeners")):this._listeners.domains.length||this._listeners.entities.length?(0,y.qy)(l||(l=(0,_.A)(["\n                <p>\n                  ","\n                </p>\n                <ul>\n                  ","\n                  ","\n                </ul>\n              "])),this.hass.localize("ui.dialogs.helper_settings.template.listeners"),this._listeners.domains.sort().map((function(e){return(0,y.qy)(o||(o=(0,_.A)(["\n                        <li>\n                          <b\n                            >","</b\n                          >: ","\n                        </li>\n                      "])),t.hass.localize("ui.dialogs.helper_settings.template.domain"),e)})),this._listeners.entities.sort().map((function(e){return(0,y.qy)(u||(u=(0,_.A)(["\n                        <li>\n                          <b\n                            >","</b\n                          >: ","\n                        </li>\n                      "])),t.hass.localize("ui.dialogs.helper_settings.template.entity"),e)}))):this._listeners.time?y.s6:(0,y.qy)(d||(d=(0,_.A)(['<p class="all_listeners">\n                  ',"\n                </p>"])),this.hass.localize("ui.dialogs.helper_settings.template.no_listeners")):y.s6)}},{kind:"field",key:"_setPreview",value:function(){var e=this;return function(t){if("error"in t)return e._error=t.error,void(e._preview=void 0);e._error=void 0,e._listeners=t.listeners;var i=(new Date).toISOString();e._preview={entity_id:"".concat(e.stepId,".___flow_preview___"),last_changed:i,last_updated:i,context:{id:"",parent_id:null,user_id:null},attributes:t.attributes,state:t.state}}}},{kind:"field",key:"_debouncedSubscribePreview",value:function(){var e=this;return(0,g.s)((function(){e._subscribePreview()}),250)}},{kind:"method",key:"_subscribePreview",value:(i=(0,c.A)((0,h.A)().mark((function e(){return(0,h.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._unsub){e.next=6;break}return e.next=3,this._unsub;case 3:e.t0=e.sent,(0,e.t0)(),this._unsub=void 0;case 6:if("repair_flow"!==this.flowType){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,this._unsub=(t=this.hass,i=this.flowId,s=this.flowType,n=this.stepData,r=this._setPreview,t.connection.subscribeMessage(r,{type:"template/start_preview",flow_id:i,flow_type:s,user_input:n})),e.next=12,this._unsub;case 12:(0,A.r)(this,"set-flow-errors",{errors:{}}),e.next=20;break;case 15:e.prev=15,e.t1=e.catch(8),"string"==typeof e.t1.message?this._error=e.t1.message:(this._error=void 0,(0,A.r)(this,"set-flow-errors",e.t1.message)),this._unsub=void 0,this._preview=void 0;case 20:case"end":return e.stop()}var t,i,s,n,r}),e,this,[[8,15]])}))),function(){return i.apply(this,arguments)})}]}}),y.WF)}}]);