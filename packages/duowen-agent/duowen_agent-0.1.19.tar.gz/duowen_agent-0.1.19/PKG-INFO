Metadata-Version: 2.1
Name: duowen-agent
Version: 0.1.19
Summary: 多闻LLM核心工具包
Author: liurui
Author-email: liurui@asiainfo.com
Requires-Python: >=3.10,<4
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Dist: PyYAML (>=5.3)
Requires-Dist: elasticsearch (>=7.10.1)
Requires-Dist: hanziconv (>=0.3.2,<0.4.0)
Requires-Dist: html2text (>=2024.2.26,<2025.0.0)
Requires-Dist: jieba (>=0.40)
Requires-Dist: jinja2 (>=3.0.3)
Requires-Dist: json5 (>=0.9.0)
Requires-Dist: mammoth (>=1.8.0,<1.9.0)
Requires-Dist: markdownify (>=0.13.1,<0.14.0)
Requires-Dist: matplotlib (==3.9.2)
Requires-Dist: nltk (>=3.9.1,<4.0.0)
Requires-Dist: numpy (>=1.0)
Requires-Dist: openai (>=1.10.0)
Requires-Dist: openpyxl (==3.1.2)
Requires-Dist: pandas (==2.2.1)
Requires-Dist: pptx2md (==1.7.1)
Requires-Dist: pydantic (>=2.7.0)
Requires-Dist: pymupdf4llm (>=0.0.17,<0.0.18)
Requires-Dist: python-dotenv (>=0.21.0)
Requires-Dist: rake-nltk (>=1.0.6,<2.0.0)
Requires-Dist: requests (>=2,<3)
Requires-Dist: scipy (==1.14.1)
Requires-Dist: sqlalchemy (>=1.4,<3)
Requires-Dist: tiktoken (>=0.7,<1)
Requires-Dist: trafilatura (>=2.0.0,<3.0.0)
Description-Content-Type: text/markdown

# 多闻(duowen)语言模型工具包

LLM核心开发包

## 模型

### 语言模型

```python
from duowen_agent.llm import OpenAIChat
from os import getenv

llm_cfg = {"model": "THUDM/glm-4-9b-chat", "base_url": "https://api.siliconflow.cn/v1",
           "api_key": getenv("SILICONFLOW_API_KEY")}

_llm = OpenAIChat(**llm_cfg)

print(_llm.chat('''If you are here, please only reply "1".'''))

for i in _llm.chat_for_stream('''If you are here, please only reply "1".'''):
    print(i)

```

### 嵌入模型

#### 调用

```python
from duowen_agent.llm import OpenAIEmbedding
from os import getenv

emb_cfg = {"model": "BAAI/bge-large-zh-v1.5", "base_url": "https://api.siliconflow.cn/v1",
           "api_key": getenv("SILICONFLOW_API_KEY")}

_emb = OpenAIEmbedding(**emb_cfg)
print(_emb.get_embedding('123'))
print(_emb.get_embedding(['123', '456']))
```

#### 缓存

```python
from duowen_agent.llm import OpenAIEmbedding, EmbeddingCache
from os import getenv
from duowen_agent.utils.cache import Cache
from redis import StrictRedis
from typing import List, Optional, Any

emb_cfg = {"model": "BAAI/bge-large-zh-v1.5", "base_url": "https://api.siliconflow.cn/v1",
           "api_key": getenv("SILICONFLOW_API_KEY")}

_emb = OpenAIEmbedding(**emb_cfg)

redis = StrictRedis(host='127.0.0.1', port=6379)


class RedisCache(Cache):
    # 基于Cache 接口类实现  redis缓存
    def __init__(self, redis_cli: StrictRedis):
        self.redis_cli = redis_cli
        super().__init__()

    def set(self, key, value, expire=60):
        return self.redis_cli.set(key, value, ex=expire)

    def mget(self, keys: List[str]) -> List[Optional[Any]]:
        return self.redis_cli.mget(keys)

    def get(self, key: str) -> Optional[Any]:
        return self.redis_cli.get(key)

    def delete(self, key: str):
        return self.redis_cli.delete(key)

    def exists(self, key: str) -> bool:
        return self.redis_cli.exists(key)

    def clear(self):
        raise InterruptedError("不支持")


embedding_cache = EmbeddingCache(RedisCache(redis), _emb)
print(embedding_cache.get_embedding('hello world'))
for i in embedding_cache.get_embedding(['sadfasf', 'hello world']):
    print(i)
```

## 重排
```python
from duowen_agent.llm import GeneralRerank
from os import getenv
import tiktoken

rerank_cfg = {
    "model": "BAAI/bge-reranker-v2-m3", 
    "base_url": "https://api.siliconflow.cn/v1/rerank",
    "api_key": getenv("SILICONFLOW_API_KEY")}

rerank = GeneralRerank(
    model=rerank_cfg["model"], 
    api_key=rerank_cfg["api_key"],
    base_url=rerank_cfg["base_url"], 
    encoding=tiktoken.get_encoding("o200k_base")
)

data = rerank.rerank(query='Apple', documents=["苹果", "香蕉", "水果", "蔬菜"], top_n=3)
for i in data:
    print(i)
```

## Rag

### 文本切割

#### token切割

