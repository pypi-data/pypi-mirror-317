"use strict";(self.webpackChunkxorbits_ui=self.webpackChunkxorbits_ui||[]).push([[187],{187:(e,t,r)=>{r.r(t),r.d(t,{default:()=>K});var n=r(1543),o=r(8239),i=r(538),a=r(5556),l=r.n(a),s=r(6540),c=r(6347),p=r(6227),u=r(183),d=r(6752),f=r(1005),h=r(1360);function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function m(e){var t=function(e){if("object"!=y(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==y(t)?t:t+""}function g(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(g=function(){return!!e})()}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function E(e,t){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},E(e,t)}var S=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=v(t),function(e,t){if(t&&("object"==y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,g()?Reflect.construct(t,r||[],v(e).constructor):t.apply(e,r))}(this,t,[e])).state={nodeStatusMap:[{text:"Pending",color:"#FFFFFF"},{text:"Running",color:"#F4B400"},{text:"Succeeded",color:"#00CD95"},{text:"Failed",color:"#E74C3C"},{text:"Cancelled",color:"#BFC9CA"}],inputNodeColor:"#3281a8",outputNodeColor:"#c334eb"},r.lastSelectedId=null,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t)}(t,e),r=t,n=[{key:"componentDidMount",value:function(){this.g=(new d.graphlib.Graph).setGraph({})}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"getNodeStyle",value:function(e){return e!==this.lastSelectedId?"cursor: pointer; stroke: #333; fill: url(#progress-"+e+")":"cursor: pointer; stroke: #ff5252; stroke-width: 3; fill: url(#progress-"+e+")"}},{key:"componentDidUpdate",value:function(e,t,r){var n=this;if(void 0!==this.props&&void 0!==this.props.nodes&&0!==this.props.nodes.length){if(e.nodes!==this.props.nodes&&e.dependencies!==this.props.dependencies){(0,u.A)("#"+this.props.graphName).selectAll("*").remove();var o=(0,u.A)("#"+this.props.graphName),i=o.append("g");this.g=(new d.graphlib.Graph).setGraph({}),this.props.nodes.forEach((function(e){var t=n.props.nodesStatus[e.id],r={node:e};if("tileableGraph"===n.props.graphName){var o=e.name.indexOf("key")-1;r.label=e.name.substring(0,o)}else"subtaskGraph"===n.props.graphName&&(r.label="");"tileableGraph"===n.props.graphName?r.rx=r.ry=5:"subtaskGraph"===n.props.graphName&&(r.r=20),n.g.setNode(e.id,r);var a=i.append("linearGradient").attr("id","progress-"+e.id),l=n.g.node(e.id);void 0===t?a.append("stop").attr("id","progress-"+e.id+"-stop").attr("stop-color","#FFFFFF").attr("offset",1):-1===t.status&&-1===t.progress?a.append("stop").attr("id","progress-"+e.id+"-stop").attr("stop-color",n.state.inputNodeColor).attr("offset",1):-2===t.status&&-2===t.progress?a.append("stop").attr("id","progress-"+e.id+"-stop").attr("stop-color",n.state.outputNodeColor).attr("offset",1):a.append("stop").attr("id","progress-"+e.id+"-stop").attr("stop-color",n.state.nodeStatusMap[t.status].color).attr("offset",t.progress),a.append("stop").attr("stop-color","#FFFFFF").attr("offset","0"),l.shape=n.props.nodeShape,l.style=n.getNodeStyle(e.id),l.labelStyle="cursor: pointer"})),this.props.dependencies.forEach((function(e){e.linkType&&1===e.linkType?n.g.setEdge(e.fromNodeId,e.toNodeId,{style:"stroke: #333; fill: none; stroke-dasharray: 5, 5;"}):n.g.setEdge(e.fromNodeId,e.toNodeId,{style:"stroke: #333; fill: none;"})}));var a=this.g;a.nodes().forEach((function(e){var t=a.node(e);t.rx=t.ry=5}));var l=new d.render;0!==this.props.nodes.length&&l(i,this.g),i.selectAll("g.node").on("click",(function(e,t){if(n.props.onNodeClick){var r=n.props.nodes.filter((function(e){return e.id===t}))[0],o=n.props.nodesStatus[r.id];if(r.properties=o.properties,t!==n.lastSelectedId){var a=n.lastSelectedId;n.lastSelectedId=t,null!==a&&(n.g.node(a).style=n.getNodeStyle(a)),n.g.node(t).style=n.getNodeStyle(t),l(i,n.g)}n.props.onNodeClick(e,r)}}));var s=i.node().getBBox(),c=i.node().parentElement,p=s.width,h=s.height,y=c.clientWidth,b=c.clientHeight,m=b>=h?1:b/h;(0,u.A)("#"+this.props.graphName).select(".output").attr("transform","translate("+(y-p*m)/2+", "+(b-h*m)/2+")");var g=(0,f.s_)().on("zoom",(function(e){i.attr("transform",e.transform)}));o.call(g,g.transform,f.GS.scale(m)),null!==this.g.graph()||void 0!==this.g.graph()?o.attr("height",this.g.graph().height*m+40):o.attr("height",40)}if(e.nodes===this.props.nodes&&e.dependencies===this.props.dependencies&&e.nodesStatus!==this.props.nodesStatus){var v=(0,u.A)("#"+this.props.graphName);this.props.nodes.forEach((function(e){var t=n.props.nodesStatus[e.id];if(void 0!==t&&t.status>=0&&t.progress>=0){var r=n.g.node(e.id);void 0!==r&&("visibility: hidden"===r.style&&(r.shape=n.props.nodeShape,r.style="cursor: pointer; stroke: #333; fill: url(#progress-"+e.id+")",r.labelStyle="cursor: pointer"),v.select("#progress-"+e.id+"-stop").attr("stop-color",n.state.nodeStatusMap[t.status].color).attr("offset",t.progress))}}))}}}},{key:"render",value:function(){return s.createElement("svg",{id:this.props.graphName,style:this.props.dagStyle})}}],n&&b(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(s.Component);function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function O(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,k(n.key),n)}}function k(e){var t=function(e){if("object"!=w(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==w(t)?t:t+""}function T(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(T=function(){return!!e})()}function j(e){return j=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},j(e)}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}S.propTypes={graphName:l().string.isRequired,dagStyle:h.ZD,nodes:h.Vq,nodeShape:l().string.isRequired,nodesStatus:h.Il,dependencies:h.AV,onNodeClick:l().func};var x=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=j(t),function(e,t){if(t&&("object"==w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,T()?Reflect.construct(t,r||[],j(e).constructor):t.apply(e,r))}(this,t,[e])).state={selectedTileable:null,tileables:[],dependencies:[],tileableDetails:{},tileableStatus:[{text:"Pending",color:"#FFFFFF",legendDotXLoc:"430",legendDotYLoc:"20",legendTextXLoc:"440",legendTextYLoc:"21"},{text:"Running",color:"#F4B400",legendDotXLoc:"10",legendDotYLoc:"20",legendTextXLoc:"20",legendTextYLoc:"21"},{text:"Succeeded",color:"#00CD95",legendDotXLoc:"105",legendDotYLoc:"20",legendTextXLoc:"115",legendTextYLoc:"21"},{text:"Failed",color:"#E74C3C",legendDotXLoc:"345",legendDotYLoc:"20",legendTextXLoc:"355",legendTextYLoc:"21"},{text:"Cancelled",color:"#BFC9CA",legendDotXLoc:"225",legendDotYLoc:"20",legendTextXLoc:"235",legendTextYLoc:"21"}]},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}(t,e),r=t,(n=[{key:"generateGraphLegendItem",value:function(e,t,r,n,o,i,a){"#FFFFFF"===i?e.append("circle").attr("cx",t).attr("cy",r).attr("r",6).attr("stroke","#333").style("fill",i):e.append("circle").attr("cx",t).attr("cy",r).attr("r",6).style("fill",i),e.append("text").attr("x",n).attr("y",o).text(a).style("font-size","15px").attr("alignment-baseline","middle")}},{key:"fetchGraphDetail",value:function(){var e=this,t=this.props,r=t.sessionId,n=t.taskId;fetch("api/session/".concat(r,"/task/").concat(n,"/tileable_graph?action=get_tileable_graph_as_json")).then((function(e){return e.json()})).then((function(t){e.setState({tileables:t.tileables.map((function(e){return{id:e.tileableId,name:e.tileableName}})),dependencies:t.dependencies.map((function(e){return{fromNodeId:e.fromTileableId,toNodeId:e.toTileableId}}))})}))}},{key:"fetchTileableDetail",value:function(){var e=this,t=this.props,r=t.sessionId,n=t.taskId;fetch("api/session/".concat(r,"/task/").concat(n,"/tileable_detail")).then((function(e){return e.json()})).then((function(t){e.setState({tileableDetails:t})}))}},{key:"componentDidMount",value:function(){var e=this;this.g=(new d.graphlib.Graph).setGraph({}),void 0!==this.interval&&clearInterval(this.interval),this.interval=setInterval((function(){return e.fetchTileableDetail()}),1e3),this.fetchTileableDetail(),this.fetchGraphDetail();var t=(0,u.A)("#tileables-legend");this.state.tileableStatus.forEach((function(r){return e.generateGraphLegendItem(t,r.legendDotXLoc,r.legendDotYLoc,r.legendTextXLoc,r.legendTextYLoc,r.color,r.text)}))}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){return void 0===this.state||void 0===this.state.tileables||void 0===this.state.dependencies||void 0===this.state.tileableDetails?s.createElement("div",null,"Loading"):s.createElement(s.Fragment,null,s.createElement("svg",{id:"tileables-legend",style:{marginLeft:"6%",width:"90%",height:"10%"}}),s.createElement(S,{graphName:"tileableGraph",dagStyle:{margin:30,width:"90%",height:"80%"},nodes:this.state.tileables,nodeShape:"rect",nodesStatus:this.state.tileableDetails,dependencies:this.state.dependencies,onNodeClick:this.props.onTileableClick}))}}])&&O(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(s.Component);x.propTypes={sessionId:l().string.isRequired,taskId:l().string.isRequired,onTileableClick:l().func};var I=r(423),P=r(4137),D=r(3884),F=r(691),C=r(6798),A=r(8878);function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function L(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,R(n.key),n)}}function R(e){var t=function(e){if("object"!=N(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=N(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==N(t)?t:t+""}function G(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(G=function(){return!!e})()}function q(e){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},q(e)}function B(e,t){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},B(e,t)}var X=(0,s.lazy)((function(){return Promise.all([r.e(731),r.e(124)]).then(r.bind(r,7124))})),Y=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=q(t),function(e,t){if(t&&("object"==N(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,G()?Reflect.construct(t,r||[],q(e).constructor):t.apply(e,r))}(this,t,[e])).state={displayedTileableDetail:0},r.handleDetailTabChange=r.handleDetailTabChange.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}(t,e),r=t,(n=[{key:"handleDetailTabChange",value:function(e,t){this.setState({displayedTileableDetail:t})}},{key:"render",value:function(){var e=this;return void 0===this.props?null:this.props.tileable?s.createElement(s.Fragment,null,s.createElement(A.A,{value:this.state.displayedTileableDetail,onChange:this.handleDetailTabChange},s.createElement(I.A,{label:"Tileable Info"}),s.createElement(I.A,{label:"Subtask Info"})),s.createElement("br",null),s.createElement("div",null,0===this.state.displayedTileableDetail?s.createElement(s.Fragment,null,s.createElement(P.A,{size:"small",style:{height:"100%"}},s.createElement(D.A,null,s.createElement(C.A,null,s.createElement(F.A,{variant:"head"},s.createElement("b",null,"Tileable ID")),s.createElement(F.A,null,this.props.tileable.id)),s.createElement(C.A,null,s.createElement(F.A,{variant:"head"},s.createElement("b",null,"Tileable Name")),s.createElement(F.A,null,this.props.tileable.name)),Object.keys(this.props.tileable.properties).map((function(t){return s.createElement(C.A,{key:t},s.createElement(F.A,{variant:"head"},s.createElement("b",null,t)),s.createElement(F.A,null,e.props.tileable.properties[t]))}))))):s.createElement(s.Suspense,{fallback:s.createElement("div",null,"Loading...")},s.createElement(X,{sessionId:this.props.sessionId,taskId:this.props.taskId,id:this.props.tileable.id})))):s.createElement(s.Fragment,null,"Select a tileable to view its detail")}}])&&L(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n}(s.Component);Y.propTypes={tileable:l().shape({id:l().string,name:l().string,properties:l().shape({id:l().string})}),sessionId:l().string.isRequired,taskId:l().string.isRequired};const M=Y;function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function V(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,U(n.key),n)}}function U(e){var t=function(e){if("object"!=z(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=z(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==z(t)?t:t+""}function W(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(W=function(){return!!e})()}function Z(e){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Z(e)}function H(e,t){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},H(e,t)}var J=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=Z(t),function(e,t){if(t&&("object"==z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,W()?Reflect.construct(t,r||[],Z(e).constructor):t.apply(e,r))}(this,t,[e])).state={selectedTileable:null},r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&H(e,t)}(t,e),r=t,(a=[{key:"render",value:function(){var e=this;return void 0===this.props?null:s.createElement(o.Ay,{container:!0,spacing:3},s.createElement(o.Ay,{item:!0,xs:12},s.createElement(p.A,null,"Task ",this.props.match.params.task_id)),s.createElement(o.Ay,{item:!0,xs:12},s.createElement(i.A,null,s.createElement(o.Ay,{container:!0,spacing:3},s.createElement(o.Ay,{item:!0,xs:12,sm:6},s.createElement(x,{sessionId:this.props.match.params.session_id,taskId:this.props.match.params.task_id,onTileableClick:function(t,r){e.setState({selectedTileable:r})}})),s.createElement(n.A,{orientation:"vertical",flexItem:!0,style:{marginRight:"-1px"}}),s.createElement(o.Ay,{item:!0,xs:12,sm:6},s.createElement(o.Ay,{item:!0,xs:12},s.createElement(M,{tileable:this.state.selectedTileable,sessionId:this.props.match.params.session_id,taskId:this.props.match.params.task_id})))))))}}])&&V(r.prototype,a),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,a}(s.Component);J.propTypes={match:l().shape({params:l().shape({session_id:l().string.isRequired,task_id:l().string.isRequired})})};const K=(0,c.y)(J)},1360:(e,t,r)=>{r.d(t,{AV:()=>l,Il:()=>a,Vq:()=>i,ZD:()=>s});var n=r(5556),o=r.n(n),i=o().arrayOf(o().shape({id:o().string.isRequired,name:o().string})),a=o().shape({id:o().shape({status:o().number.isRequired,progress:o().number.isRequired,subtaskCount:o().number,properties:o().shape({id:o().string})})}),l=o().arrayOf(o().shape({fromNodeId:o().string.isRequired,toNodeId:o().string.isRequired,linkType:o().number})),s=o().shape({margin:o().oneOfType([o().number,o().string]),padding:o().oneOfType([o().number,o().string]),width:o().oneOfType([o().number,o().string]),height:o().oneOfType([o().number,o().string])})}}]);